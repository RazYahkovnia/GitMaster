# GitMaster Extension - Architecture Rules

## File Structure
```
src/
├── types/          # Shared type definitions (interfaces only)
├── services/       # Business logic (NO VS Code API except diffService)
├── providers/      # VS Code tree views (use services for data)
├── commands/       # Command handlers (thin, delegate to services)
└── extension.ts    # Registration only (NO business logic)
```

## Layer Responsibilities

**types/** - Interfaces only, no logic
**services/** - Pure business logic, async methods, throw errors with messages
**providers/** - TreeDataProvider implementations, use services for data
**commands/** - Catch errors, show user messages, orchestrate services
**extension.ts** - Initialize services, register views/commands/listeners

## Adding Features

### New Git Operation
1. Add type to `types/git.ts` (if needed)
2. Add method to `services/gitService.ts` with JSDoc
3. Extract complex parsing to private helpers
4. Use in commands/providers

### New UI View
1. Create provider in `providers/myProvider.ts`
2. Initialize in `extension.ts` → `initializeServices()`
3. Register in `extension.ts` → `registerTreeViews()`
4. Add to `package.json` → `contributes.views`

### New Command
1. Add method to `commands/myCommands.ts` (or create new class)
2. Register in `extension.ts` → `registerCommands()`
3. Add to `package.json` → `contributes.commands`

## Code Standards

- **Error Handling**: Services throw, commands catch and show user messages
- **Async/Await**: Use for all I/O operations
- **JSDoc**: Required for public methods and interfaces
- **Naming**: camelCase files, PascalCase classes/interfaces
- **Imports**: Always use relative paths with layer structure

## Common Patterns

```typescript
// Git command in service
const { stdout } = await execAsync('git command', { cwd: repoRoot, maxBuffer: 10 * 1024 * 1024 });

// Tree view refresh
this._onDidChangeTreeData.fire();

// Command handler
try {
    const data = await this.service.getData();
    this.provider.update(data);
} catch (error) {
    vscode.window.showErrorMessage(`Failed: ${error}`);
}
```

## Don't
- ❌ Business logic in `extension.ts`
- ❌ VS Code API in services (except diffService)
- ❌ Duplicate types across files
- ❌ Silent error catching
- ❌ Direct Git calls in providers

## Reference
See `ARCHITECTURE.md` for detailed documentation and `CODE_GUIDE.md` for examples.
